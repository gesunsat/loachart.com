<!DOCTYPE html>
<html lang="ko">
<head class="h-100">
  <title>몰루 :: LoChart</title>
  <meta name="description" content="몰루">
  <script>var here = "몰루";</script>

  <!-- jquery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="js/jquery.cookie-1.4.1.min.js" > </script>

  <!-- bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

  <!-- custom -->
  <script src="js/custom.js"></script>
  <link rel="stylesheet" type="text/css" href="css/custom.css">

  <!-- google ADSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4936470262963011"
     crossorigin="anonymous"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XD44D79GLY"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-XD44D79GLY');
  </script>

  <style>
    @media (max-width: 992px) {
      .w-50 {
        width: 100%!important;
      }
    }
    video {
      width: 100%;
      border-radius: 5px;
      border: 1px solid black;
    }
  </style>
  <link href="css/cover.css" rel="stylesheet">
</head>

<body class="d-flex h-100 text-center text-white bg-dark">
  <div class="container d-flex w-100 h-100 p-3 mx-auto flex-column">

    <header class="mb-3">
      <div>
        <a href="/"><h3 class="float-md-start mb-0 text-white">LoChart</h3></a>
        <nav class="nav nav-masthead justify-content-center float-md-end"></nav>
      </div>
    </header>

    <main class="pt-5 pb-5 px-3">
      <div class="text-center">
      <!-- temp ad -->
      <div class="ad mb-5">
        <div>
          <div class="text-center">
            <ins class="kakao_ad_area" style="display:none;" rel="nofollow"
            data-ad-unit    = "DAN-XJwlOkv1K5GXhAIz" 
            data-ad-width   = "728" 
            data-ad-height  = "90"></ins>
          </div>
        </div>
        <div id="ads-left">
          <div>
            <ins class="kakao_ad_area" style="display:none;" rel="nofollow"
            data-ad-unit    = "DAN-nsfEeS2PlFxohWoX" 
            data-ad-width   = "160" 
            data-ad-height  = "600"></ins> 
          </div>
        </div>
        <div id="ads-right">
          <div>
            <ins class="kakao_ad_area" style="display:none;" rel="nofollow"
            data-ad-unit    = "DAN-XoJlI1MzVRSxM5dr" 
            data-ad-width   = "160" 
            data-ad-height  = "600"></ins> 
          </div>
        </div>
      </div>
      
      <div class="mx-auto w-50 pt-5">
        <button id="btn-test-getDisplayMedia">Test getDisplayMedia API</button>
        <hr>
        <video autoplay playsinline muted="false" volume=0></video>
        <br>
        <textarea id="settings" style="width: 100%; height: 218px; display: none;"></textarea>
        <br>
        <textarea id="capabilities" style="width: 100%; height: 354px; display: none;"></textarea>
      </div>
    </main>

    <!-- tempAd -->
    <footer class="mt-5 text-white-50">
      <div class="p-0 m-0 mb-2 text-center">
        <ins class="kakao_ad_area" style="display:none;" rel="nofollow"
        data-ad-unit    = "DAN-wTnO0MIIPOzE9w0o" 
        data-ad-width   = "728" 
        data-ad-height  = "90"></ins> 
      </div>
      
      <!-- AdSense -->
      <div class="ADsense">
        <!-- loa_market_chart -->
        <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-4936470262963011"
        data-ad-slot="8129420230"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      </div>
      <p>Cover template for <a href="https://getbootstrap.com/" class="text-white">Bootstrap</a>, by <a href="https://twitter.com/mdo" class="text-white">@mdo</a>.</p>
    </footer>
  </div>

  <script src="https://www.webrtc-experiment.com/common.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.min.js" integrity="sha512-NxocnqsXP3zm0Xb42zqVMvjQIktKEpTIbCXXyhBPxqGZHqhcOXHs4pXI/GoZ8lE+2NJONRifuBpi9DxC58L0Lw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
      function preload() {
        var video            = $('video')[0];
        var button           = $('#btn-test-getDisplayMedia')[0];
        var textarea         = $('#capabilities')[0];
        var settings         = $('#settings')[0];

        $('#btn-test-getDisplayMedia').on('click', function(){
          this.disabled = true;
          
          invokeGetDisplayMedia(function(screen) {
            addStreamStopListener(screen, function() {
              location.reload();
          });
            
            video.srcObject = screen;

            var _capabilities = screen.getTracks()[0].getCapabilities();
            capabilities.value = 'capabilities:\n\n' + JSON.stringify(_capabilities, null, '\t');
            capabilities.style.display = '';

            var _settings = screen.getTracks()[0].getSettings();
            settings.value = 'settings:\n\n' + JSON.stringify(_settings, null, '\t');
            settings.style.display = '';
        }, function(e) {
          button.disabled = false;

            var error = {
              name: e.name || 'UnKnown',
              message: e.message || 'UnKnown',
              stack: e.stack || 'UnKnown'
            };

            if(error.name === 'PermissionDeniedError') {
              if(location.protocol !== 'https:') {
                error.message = 'Please use HTTPs.';
                error.stack   = 'HTTPs is required.';
              }
            }

            console.error(error.name);
            console.error(error.message);
            console.error(error.stack);

            alert('Unable to capture your screen.\n\n' + error.name + '\n\n' + error.message + '\n\n' + error.stack);
          });
        });

        if(!navigator.getDisplayMedia && !navigator.mediaDevices.getDisplayMedia) {
          var error = 'Your browser does NOT supports getDisplayMedia API.';
          $('h1').innerHTML = error;
          $('h1').style.color = 'red';

          $('video').style.display = 'none';
          button.style.display = 'none';
          throw new Error(error);
        }

        function invokeGetDisplayMedia(success, error) {
          var videoConstraints = {};

          videoConstraints.aspectRatio = screen.width/screen.height;
          videoConstraints.frameRate = 30;
          videoConstraints.width = screen.width;
          videoConstraints.height = screen.height;
          

          if(!Object.keys(videoConstraints).length) {
            videoConstraints = true;
          }

          var displayMediaStreamConstraints = {
            video: videoConstraints
          };

          if(navigator.mediaDevices.getDisplayMedia) {
            navigator.mediaDevices.getDisplayMedia(displayMediaStreamConstraints).then(success).catch(error);
          }
          else {
            navigator.getDisplayMedia(displayMediaStreamConstraints).then(success).catch(error);
          }
        }

        function addStreamStopListener(stream, callback) {
          stream.addEventListener('ended', function() {
            callback();
            callback = function() {};
          }, false);
          stream.addEventListener('inactive', function() {
            callback();
            callback = function() {};
          }, false);
          stream.getTracks().forEach(function(track) {
            track.addEventListener('ended', function() {
              callback();
              callback = function() {};
            }, false);
            track.addEventListener('inactive', function() {
              callback();
              callback = function() {};
            }, false);
          });
        }
      }

      let cam;
      function setup() {
        createCanvas(400, 300);
        cam = createCapture($('video'));
        cam.size(400, 300);
        //cam.hide();
      }

      function draw(){
        grayscale();
      }

      function grayscale(){
        loadPixels();
        cam.loadPixels();
        for(let y = 0; y < height; y++){
          for(let x = 0; x < width*4; x+=4){
            let xy = x+y*width*4;
            let gray = (cam.pixels[xy+0]+cam.pixels[xy+1]+cam.pixels[xy+2])/3;
            pixels[xy+0] = gray;
            pixels[xy+1] = gray;
            pixels[xy+2] = gray;
            pixels[xy+3] = 255;
          }
        }
        updatePixels();
      }
  </script>
</body>
</html>